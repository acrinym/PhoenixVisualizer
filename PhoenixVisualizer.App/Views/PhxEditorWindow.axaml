<!-- PhoenixVisualizer/PhoenixVisualizer.App/Views/PhxEditorWindow.axaml -->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="using:PhoenixVisualizer.Views"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
        x:Class="PhoenixVisualizer.Views.PhxEditorWindow"
        x:DataType="views:PhxEditorViewModel"
        Title="PHX Editor - Advanced Visual Effects Composer"
        Width="1400" Height="900"
        Icon="/Assets/avalonia-logo.ico">

    <Window.Resources>
        <SolidColorBrush x:Key="EditorBackground" Color="#1e1e1e"/>
        <SolidColorBrush x:Key="PanelBackground" Color="#2d2d30"/>
        <SolidColorBrush x:Key="BorderColor" Color="#3e3e42"/>
        <SolidColorBrush x:Key="TextColor" Color="#f1f1f1"/>
        <SolidColorBrush x:Key="AccentColor" Color="#007acc"/>
    </Window.Resources>

    <Grid Background="{StaticResource EditorBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Menu Bar -->
            <RowDefinition Height="*"/>    <!-- Main Content -->
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Border Grid.Row="0" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" Margin="8" Spacing="16">
                <Button Content="📁 New" Command="{Binding NewPresetCommand}" ToolTip.Tip="Create new preset"/>
                <Button Content="📂 Open" Command="{Binding OpenPresetCommand}" ToolTip.Tip="Open existing preset"/>
                <Button Content="💾 Save" Command="{Binding SavePresetCommand}" ToolTip.Tip="Save current preset"/>
                <Button Content="💾 Save As" Command="{Binding SaveAsPresetCommand}" ToolTip.Tip="Save preset with new name"/>
                <Button Content="📤 Export AVS" Command="{Binding ExportAvsCommand}" ToolTip.Tip="Export as AVS preset"/>
                <Button Content="📥 Import AVS" Command="{Binding ImportAvsCommand}" ToolTip.Tip="Import AVS preset"/>
                <Separator/>
                <Button Content="↶ Undo" Command="{Binding UndoCommand}" ToolTip.Tip="Undo last action"/>
                <Button Content="↷ Redo" Command="{Binding RedoCommand}" ToolTip.Tip="Redo last action"/>
                <Separator/>
                <Button Content="✂️ Cut" Command="{Binding CutCommand}" ToolTip.Tip="Cut selected effect"/>
                <Button Content="📋 Copy" Command="{Binding CopyCommand}" ToolTip.Tip="Copy selected effect"/>
                <Button Content="📄 Paste" Command="{Binding PasteCommand}" ToolTip.Tip="Paste effect"/>
                <Button Content="🗑️ Delete" Command="{Binding DeleteEffectCommand}" ToolTip.Tip="Delete selected effect"/>
                <Button Content="📋 Duplicate" Command="{Binding DuplicateEffectCommand}" ToolTip.Tip="Duplicate selected effect"/>
                <Separator/>
                <Button Content="🔧 Compile" Command="{Binding CompileCommand}" Background="Green" Foreground="White" ToolTip.Tip="Compile code"/>
                <Button Content="🧪 Test" Command="{Binding TestCodeCommand}" Background="Orange" Foreground="White" ToolTip.Tip="Test code execution"/>
                <Button Content="▶️ Play" Command="{Binding PlayCommand}" Background="Blue" Foreground="White" ToolTip.Tip="Play preview"/>
                <Button Content="⏸️ Pause" Command="{Binding PauseCommand}" Background="Gray" Foreground="White" ToolTip.Tip="Pause preview"/>
                <Button Content="🔄 Restart" Command="{Binding RestartCommand}" Background="Purple" Foreground="White" ToolTip.Tip="Restart preview"/>
                <Separator/>
                <Button Content="📖 Help" Command="{Binding HelpCommand}" ToolTip.Tip="Show help"/>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/> <!-- Left Sidebar -->
                <ColumnDefinition Width="*"/>   <!-- Center Content -->
                <ColumnDefinition Width="350"/> <!-- Right Sidebar -->
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar: Effect Library -->
            <Border Grid.Column="0" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Effect Library" FontWeight="Bold" Margin="8,8,8,4"
                               Foreground="{StaticResource TextColor}"/>

                    <TabControl Grid.Row="1" Margin="4">
                        <TabItem Header="Phoenix" Background="Transparent">
                            <ListBox ItemsSource="{Binding PhoenixOriginals}"
                                     SelectedItem="{Binding SelectedLibraryEffect}"
                                     Background="{StaticResource PanelBackground}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextColor}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </TabItem>
                        <TabItem Header="AVS" Background="Transparent">
                            <ListBox ItemsSource="{Binding AvsEffects}"
                                     SelectedItem="{Binding SelectedLibraryEffect}"
                                     Background="{StaticResource PanelBackground}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextColor}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </TabItem>
                        <TabItem Header="Research" Background="Transparent">
                            <ListBox ItemsSource="{Binding ResearchEffects}"
                                     SelectedItem="{Binding SelectedLibraryEffect}"
                                     Background="{StaticResource PanelBackground}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" Foreground="{StaticResource TextColor}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Border>

            <!-- Center: Main Content Area -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>    <!-- Effect Stack / Code Editor -->
                    <RowDefinition Height="Auto"/>  <!-- Status Bar -->
                </Grid.RowDefinitions>

                <!-- Tab Control for Effect Stack and Code Editor -->
                <TabControl Grid.Row="0" SelectedIndex="{Binding SelectedTabIndex}" Margin="4">
                    <TabItem Header="Effect Stack" Background="Transparent">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                                <Button Content="➕ Add Effect" Command="{Binding AddEffectCommand}" Margin="0,0,8,0"/>
                                <Button Content="🗑️ Remove" Command="{Binding DeleteEffectCommand}"/>
                            </StackPanel>

                            <ListBox Grid.Row="1" ItemsSource="{Binding EffectStack}"
                                     SelectedItem="{Binding SelectedEffect}"
                                     Background="{StaticResource PanelBackground}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding DisplayName}" Foreground="{StaticResource TextColor}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <TextBlock Grid.Row="2" Text="{Binding StatusMessage}" Margin="0,8,0,0"
                                       Foreground="{StaticResource TextColor}"/>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Code Editor" Background="Transparent">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Code Sections" FontWeight="Bold" Margin="0,0,0,8"
                                       Foreground="{StaticResource TextColor}"/>

                            <TabControl Grid.Row="1">
                                <TabItem Header="Init Code">
                                    <TextBox Text="{Binding InitCode}" AcceptsReturn="True" AcceptsTab="True"
                                             Background="{StaticResource PanelBackground}"
                                             Foreground="{StaticResource TextColor}"
                                             FontFamily="Consolas" FontSize="12"
                                             Watermark="Enter initialization code here..."/>
                                </TabItem>
                                <TabItem Header="Frame Code">
                                    <TextBox Text="{Binding FrameCode}" AcceptsReturn="True" AcceptsTab="True"
                                             Background="{StaticResource PanelBackground}"
                                             Foreground="{StaticResource TextColor}"
                                             FontFamily="Consolas" FontSize="12"
                                             Watermark="Enter per-frame code here..."/>
                                </TabItem>
                                <TabItem Header="Point Code">
                                    <TextBox Text="{Binding PointCode}" AcceptsReturn="True" AcceptsTab="True"
                                             Background="{StaticResource PanelBackground}"
                                             Foreground="{StaticResource TextColor}"
                                             FontFamily="Consolas" FontSize="12"
                                             Watermark="Enter per-point code here..."/>
                                </TabItem>
                                <TabItem Header="Beat Code">
                                    <TextBox Text="{Binding BeatCode}" AcceptsReturn="True" AcceptsTab="True"
                                             Background="{StaticResource PanelBackground}"
                                             Foreground="{StaticResource TextColor}"
                                             FontFamily="Consolas" FontSize="12"
                                             Watermark="Enter beat-triggered code here..."/>
                                </TabItem>
                            </TabControl>

                            <TextBlock Grid.Row="2" Text="{Binding CodeStatus}" Margin="0,8,0,0"
                                       Foreground="{StaticResource TextColor}"/>
                        </Grid>
                    </TabItem>
                </TabControl>

                <!-- Status Bar -->
                <Border Grid.Row="1" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,1,0,0"
                        Background="{StaticResource PanelBackground}">
                    <StackPanel Orientation="Horizontal" Margin="8" Spacing="16">
                        <TextBlock Text="{Binding StatusMessage}" Foreground="{StaticResource TextColor}"/>
                        <Separator/>
                        <TextBlock Text="{Binding FpsCounter}" Foreground="{StaticResource AccentColor}"/>
                        <TextBlock Text="{Binding MemoryUsage}" Foreground="{StaticResource TextColor}"/>
                        <Separator/>
                        <TextBlock Text="{Binding PresetName}" Foreground="{StaticResource TextColor}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Right Sidebar: Properties & Preview -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>    <!-- Properties -->
                    <RowDefinition Height="250"/>  <!-- Preview -->
                </Grid.RowDefinitions>

                <!-- Properties Panel -->
                <Border Grid.Row="0" BorderBrush="{StaticResource BorderColor}" BorderThickness="1,0,0,1">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Properties" FontWeight="Bold" Margin="8,8,8,4"
                                   Foreground="{StaticResource TextColor}"/>

                        <ScrollViewer Grid.Row="1">
                            <StackPanel x:Name="ParametersPanel" Margin="8,0,8,8" Spacing="8">
                                <!-- Parameters will be dynamically added here by ParameterEditor -->
                                <TextBlock Text="Select an effect to edit parameters"
                                           Foreground="{StaticResource TextColor}" Opacity="0.6"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- Preview Panel -->
                <Border Grid.Row="1" BorderBrush="{StaticResource BorderColor}" BorderThickness="1,0,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="Live Preview" FontWeight="Bold" Margin="8,8,8,4"
                                   Foreground="{StaticResource TextColor}"/>

                        <Canvas x:Name="PreviewCanvas" Grid.Row="1" Background="Black" Margin="8,0,8,8"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
